

# make_model2_meta_flp_large.py

## Build Model-2 Metadata with FLP Capacity Targets

---

## Purpose

This script constructs the **Model-2 training dataset** by merging:

* Structural and topology metadata from Model-1
* Computed FLP capacity metrics from the void-network analysis

The final output is:

```
cof_meta_model2_flp_large.csv
```

This file is the training-ready dataset used to build Model-2, which predicts FLP catalytic capacity.

---

# Conceptual Role in the Pipeline

Pipeline flow:

```
COF generation
   ↓
LAMMPS optimization
   ↓
Zeo++ void network
   ↓
FLP capacity calculation
   ↓
make_model2_meta_flp_large.py   ← This script
   ↓
Model-2 ML training
```

Model-1 predicts geometric properties (PLD, LCD).
Model-2 predicts FLP capacity.

---

# Inputs Required

## 1. Clean Model-1 Metadata

```
cof_meta_model1_clean.csv
```

This file must contain:

* cof_id
* topology information
* linker IDs
* coverage fraction
* base ID
* LCD and PLD values

Only COFs that passed structural and optimization filtering are present here.

---

## 2. FLP Summary Files

Each COF folder must contain a file:

```
COF_CIFs/COF_XXXXXX/COF_XXXXXX_FLP_large_summary.txt
```

These summary files are generated by:

```
flp_batch_all_in_one_n1.py
```

Each summary file contains:

* N_base_FLP
* C_FLP
* N_base_FLP_sim
* C_FLP_sim

Example:

```
N_base_FLP      = 22
C_FLP           = 8.854163
N_base_FLP_sim  = 8
C_FLP_sim       = 4.045839
```

---

# Target Radius Selection

```
RADIUS_TAG = "large"
```

Possible options:

* "small"
* "medium"
* "large"

The output file name is automatically constructed as:

```
cof_meta_model2_flp_large.csv
```

---

# What This Script Extracts

For each COF:

1. Reads the summary file.
2. Extracts the four FLP metrics.
3. Builds a temporary target table.
4. Merges with Model-1 metadata.

Only COFs with both metadata AND FLP summary are retained.

---

# Definition of FLP Capacity Metrics

The following quantities are extracted:

### 1. N_base_FLP

Number of nitrogen sites that satisfy all FLP geometric and accessibility criteria.

### 2. C_FLP

Total FLP capacity score across all valid sites.

Defined as:

```
C_FLP = sum(Q_i over all accepted sites)
```

### 3. N_base_FLP_sim

Number of non-overlapping FLP pockets that can operate simultaneously.

### 4. C_FLP_sim

Simultaneous FLP capacity.

Defined as:

```
C_FLP_sim = sum(Q_i over non-overlapping sites)
```

This accounts for steric exclusion between neighboring acid pockets.

---

# Definition of Site Quality Score (Q)

Each FLP site score Q is defined as:

```
Q = f_d * f_o * f_CO2 * f_H2
```

Where:

* f_d    = distance feasibility score
* f_o    = lone pair orientation score
* f_CO2  = CO2 accessibility score
* f_H2   = H2 accessibility score

All four conditions must be satisfied simultaneously.

---

# Target Used for Model-2

By default:

```
TARGET_COL = "C_FLP_sim"
```

Reason:

* Represents realistic simultaneous catalytic capacity
* Accounts for steric overlap
* Physically meaningful
* More robust than raw site count

Rows with missing target values are removed.

---

# Output

```
cof_meta_model2_flp_large.csv
```

The output contains:

* All structural descriptors (from Model-1)
* FLP capacity metrics
* Clean regression target for Model-2

Console output includes:

* Total COFs in metadata
* Number of FLP summaries parsed
* Missing summary count
* Final dataset size
* Target value range

---

# Why This Step Is Critical

This script ensures:

* Clean alignment between structure and FLP capacity
* Removal of incomplete FLP calculations
* Consistent target definition
* Fully ML-ready dataset

It is the transition from structural modeling to catalytic capacity prediction.

---

# How to Run

From project root:

```
python make_model2_meta_flp_large.py
```

Make sure:

* Model-1 metadata exists
* COF_CIFs folders exist
* FLP summary files exist

---


